<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tzcpa.mapper.student.TeamAnnualWorthGatherMapper" >
  <resultMap id="BaseResultMap" type="com.tzcpa.model.student.TeamAnnualWorthGather" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <result column="id" property="id" jdbcType="INTEGER" />
    <result column="year" property="year" jdbcType="INTEGER" />
    <result column="net_assets_income_rate" property="netAssetsIncomeRate" jdbcType="DECIMAL" />
    <result column="retained_profits" property="retainedProfits" jdbcType="VARCHAR" />
    <result column="operation_revenue" property="operationRevenue" jdbcType="VARCHAR" />
    <result column="net_asset_value_per_share" property="netAssetValuePerShare" jdbcType="VARCHAR" />
    <result column="earnings_per_share" property="earningsPerShare" jdbcType="VARCHAR" />
    <result column="sales_margin" property="salesMargin" jdbcType="VARCHAR" />
    <result column="gross_margin" property="grossMargin" jdbcType="VARCHAR" />
    <result column="net_profit_margin_on_sales" property="netProfitMarginOnSales" jdbcType="VARCHAR" />
    <result column="operating_profit_ratio" property="operatingProfitRatio" jdbcType="VARCHAR" />
    <result column="year_over_year_growth_in_earnings_per_share" property="yearOverYearGrowthInEarningsPerShare" jdbcType="VARCHAR" />
    <result column="year_over_year_growth_rate_of_operating_income" property="yearOverYearGrowthRateOfOperatingIncome" jdbcType="VARCHAR" />
    <result column="year_on_year_growth_rate_of_net_profit" property="yearOnYearGrowthRateOfNetProfit" jdbcType="VARCHAR" />
    <result column="year_over_year_return_on_equity_growth" property="yearOverYearReturnOnEquityGrowth" jdbcType="VARCHAR" />
    <result column="rate_of_stock_turnover" property="rateOfStockTurnover" jdbcType="VARCHAR" />
    <result column="turnover_of_total_capital" property="turnoverOfTotalCapital" jdbcType="VARCHAR" />
    <result column="total_assets" property="totalAssets" jdbcType="VARCHAR" />
    <result column="net_asset" property="netAsset" jdbcType="VARCHAR" />
    <result column="asset_liability_ratio" property="assetLiabilityRatio" jdbcType="VARCHAR" />
    <result column="liquidity_ratio" property="liquidityRatio" jdbcType="VARCHAR" />
    <result column="quick_ratio" property="quickRatio" jdbcType="VARCHAR" />
    <result column="sales_growth_rate" property="salesGrowthRate" jdbcType="VARCHAR" />
    <result column="composition_of_operating_income_limousine" property="compositionOfOperatingIncomeLimousine" jdbcType="VARCHAR" />
    <result column="composition_of_operating_income_h6" property="compositionOfOperatingIncomeH6" jdbcType="VARCHAR" />
    <result column="composition_of_operating_income_pickup" property="compositionOfOperatingIncomePickup" jdbcType="VARCHAR" />
    <result column="composition_of_operating_income_wey" property="compositionOfOperatingIncomeWey" jdbcType="VARCHAR" />
    <result column="composition_of_operating_income_h8" property="compositionOfOperatingIncomeH8" jdbcType="VARCHAR" />
    <result column="composition_of_net_profit_limousine" property="compositionOfNetProfitLimousine" jdbcType="VARCHAR" />
    <result column="composition_of_net_profit_h6" property="compositionOfNetProfitH6" jdbcType="VARCHAR" />
    <result column="composition_of_net_profit_pickup" property="compositionOfNetProfitPickup" jdbcType="VARCHAR" />
    <result column="composition_of_net_profit_wey" property="compositionOfNetProfitWey" jdbcType="VARCHAR" />
    <result column="composition_of_net_profit_h8" property="compositionOfNetProfitH8" jdbcType="VARCHAR" />
    <result column="development_expenditure" property="developmentExpenditure" jdbcType="VARCHAR" />
    <result column="development_expenditure_percentage_revenue" property="developmentExpenditurePercentageRevenue" jdbcType="VARCHAR" />
    <result column="h6_market_share" property="h6MarketShare" jdbcType="VARCHAR" />
    <result column="h8_market_share" property="h8MarketShare" jdbcType="VARCHAR" />
    <result column="wey_market_share" property="weyMarketShare" jdbcType="VARCHAR" />
    <result column="new_product_contribution_rate" property="newProductContributionRate" jdbcType="VARCHAR" />
    <result column="class_id" property="classId" jdbcType="INTEGER" />
    <result column="team_id" property="teamId" jdbcType="INTEGER" />
  </resultMap>
  <insert id="insert" parameterType="com.tzcpa.model.student.TeamAnnualWorthGather" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey resultType="java.lang.Integer" keyProperty="id" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into t_team_annual_worth_gather (`year`, net_assets_income_rate, retained_profits, 
      operation_revenue, net_asset_value_per_share, 
      earnings_per_share, sales_margin, gross_margin, 
      net_profit_margin_on_sales, operating_profit_ratio, 
      year_over_year_growth_in_earnings_per_share, year_over_year_growth_rate_of_operating_income, 
      year_on_year_growth_rate_of_net_profit, year_over_year_return_on_equity_growth, 
      rate_of_stock_turnover, turnover_of_total_capital, 
      total_assets, net_asset, asset_liability_ratio, 
      liquidity_ratio, quick_ratio, sales_growth_rate, 
      composition_of_operating_income_limousine, composition_of_operating_income_h6, 
      composition_of_operating_income_pickup, composition_of_operating_income_wey, 
      composition_of_operating_income_h8, composition_of_net_profit_limousine, 
      composition_of_net_profit_h6, composition_of_net_profit_pickup, 
      composition_of_net_profit_wey, composition_of_net_profit_h8, 
      development_expenditure, development_expenditure_percentage_revenue, 
      h6_market_share, h8_market_share, wey_market_share, 
      new_product_contribution_rate, class_id, team_id
      )
    values (#{year,jdbcType=INTEGER}, #{netAssetsIncomeRate,jdbcType=DECIMAL}, #{retainedProfits,jdbcType=VARCHAR},
      #{operationRevenue,jdbcType=VARCHAR}, #{netAssetValuePerShare,jdbcType=VARCHAR}, 
      #{earningsPerShare,jdbcType=VARCHAR}, #{salesMargin,jdbcType=VARCHAR}, #{grossMargin,jdbcType=VARCHAR}, 
      #{netProfitMarginOnSales,jdbcType=VARCHAR}, #{operatingProfitRatio,jdbcType=VARCHAR}, 
      #{yearOverYearGrowthInEarningsPerShare,jdbcType=VARCHAR}, #{yearOverYearGrowthRateOfOperatingIncome,jdbcType=VARCHAR}, 
      #{yearOnYearGrowthRateOfNetProfit,jdbcType=VARCHAR}, #{yearOverYearReturnOnEquityGrowth,jdbcType=VARCHAR}, 
      #{rateOfStockTurnover,jdbcType=VARCHAR}, #{turnoverOfTotalCapital,jdbcType=VARCHAR}, 
      #{totalAssets,jdbcType=VARCHAR}, #{netAsset,jdbcType=VARCHAR}, #{assetLiabilityRatio,jdbcType=VARCHAR}, 
      #{liquidityRatio,jdbcType=VARCHAR}, #{quickRatio,jdbcType=VARCHAR}, #{salesGrowthRate,jdbcType=VARCHAR}, 
      #{compositionOfOperatingIncomeLimousine,jdbcType=VARCHAR}, #{compositionOfOperatingIncomeH6,jdbcType=VARCHAR}, 
      #{compositionOfOperatingIncomePickup,jdbcType=VARCHAR}, #{compositionOfOperatingIncomeWey,jdbcType=VARCHAR}, 
      #{compositionOfOperatingIncomeH8,jdbcType=VARCHAR}, #{compositionOfNetProfitLimousine,jdbcType=VARCHAR}, 
      #{compositionOfNetProfitH6,jdbcType=VARCHAR}, #{compositionOfNetProfitPickup,jdbcType=VARCHAR}, 
      #{compositionOfNetProfitWey,jdbcType=VARCHAR}, #{compositionOfNetProfitH8,jdbcType=VARCHAR}, 
      #{developmentExpenditure,jdbcType=VARCHAR}, #{developmentExpenditurePercentageRevenue,jdbcType=VARCHAR}, 
      #{h6MarketShare,jdbcType=VARCHAR}, #{h8MarketShare,jdbcType=VARCHAR}, #{weyMarketShare,jdbcType=VARCHAR}, 
      #{newProductContributionRate,jdbcType=VARCHAR}, #{classId,jdbcType=INTEGER}, #{teamId,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.tzcpa.model.student.TeamAnnualWorthGather" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey resultType="java.lang.Integer" keyProperty="id" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into t_team_annual_worth_gather
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="year != null" >
        `year`,
      </if>
      <if test="netAssetsIncomeRate != null" >
        net_assets_income_rate,
      </if>
      <if test="retainedProfits != null" >
        retained_profits,
      </if>
      <if test="operationRevenue != null" >
        operation_revenue,
      </if>
      <if test="netAssetValuePerShare != null" >
        net_asset_value_per_share,
      </if>
      <if test="earningsPerShare != null" >
        earnings_per_share,
      </if>
      <if test="salesMargin != null" >
        sales_margin,
      </if>
      <if test="grossMargin != null" >
        gross_margin,
      </if>
      <if test="netProfitMarginOnSales != null" >
        net_profit_margin_on_sales,
      </if>
      <if test="operatingProfitRatio != null" >
        operating_profit_ratio,
      </if>
      <if test="yearOverYearGrowthInEarningsPerShare != null" >
        year_over_year_growth_in_earnings_per_share,
      </if>
      <if test="yearOverYearGrowthRateOfOperatingIncome != null" >
        year_over_year_growth_rate_of_operating_income,
      </if>
      <if test="yearOnYearGrowthRateOfNetProfit != null" >
        year_on_year_growth_rate_of_net_profit,
      </if>
      <if test="yearOverYearReturnOnEquityGrowth != null" >
        year_over_year_return_on_equity_growth,
      </if>
      <if test="rateOfStockTurnover != null" >
        rate_of_stock_turnover,
      </if>
      <if test="turnoverOfTotalCapital != null" >
        turnover_of_total_capital,
      </if>
      <if test="totalAssets != null" >
        total_assets,
      </if>
      <if test="netAsset != null" >
        net_asset,
      </if>
      <if test="assetLiabilityRatio != null" >
        asset_liability_ratio,
      </if>
      <if test="liquidityRatio != null" >
        liquidity_ratio,
      </if>
      <if test="quickRatio != null" >
        quick_ratio,
      </if>
      <if test="salesGrowthRate != null" >
        sales_growth_rate,
      </if>
      <if test="compositionOfOperatingIncomeLimousine != null" >
        composition_of_operating_income_limousine,
      </if>
      <if test="compositionOfOperatingIncomeH6 != null" >
        composition_of_operating_income_h6,
      </if>
      <if test="compositionOfOperatingIncomePickup != null" >
        composition_of_operating_income_pickup,
      </if>
      <if test="compositionOfOperatingIncomeWey != null" >
        composition_of_operating_income_wey,
      </if>
      <if test="compositionOfOperatingIncomeH8 != null" >
        composition_of_operating_income_h8,
      </if>
      <if test="compositionOfNetProfitLimousine != null" >
        composition_of_net_profit_limousine,
      </if>
      <if test="compositionOfNetProfitH6 != null" >
        composition_of_net_profit_h6,
      </if>
      <if test="compositionOfNetProfitPickup != null" >
        composition_of_net_profit_pickup,
      </if>
      <if test="compositionOfNetProfitWey != null" >
        composition_of_net_profit_wey,
      </if>
      <if test="compositionOfNetProfitH8 != null" >
        composition_of_net_profit_h8,
      </if>
      <if test="developmentExpenditure != null" >
        development_expenditure,
      </if>
      <if test="developmentExpenditurePercentageRevenue != null" >
        development_expenditure_percentage_revenue,
      </if>
      <if test="h6MarketShare != null" >
        h6_market_share,
      </if>
      <if test="h8MarketShare != null" >
        h8_market_share,
      </if>
      <if test="weyMarketShare != null" >
        wey_market_share,
      </if>
      <if test="newProductContributionRate != null" >
        new_product_contribution_rate,
      </if>
      <if test="classId != null" >
        class_id,
      </if>
      <if test="teamId != null" >
        team_id,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="year != null" >
        #{year,jdbcType=INTEGER},
      </if>
      <if test="netAssetsIncomeRate != null" >
        #{netAssetsIncomeRate,jdbcType=DECIMAL},
      </if>
      <if test="retainedProfits != null" >
        #{retainedProfits,jdbcType=VARCHAR},
      </if>
      <if test="operationRevenue != null" >
        #{operationRevenue,jdbcType=VARCHAR},
      </if>
      <if test="netAssetValuePerShare != null" >
        #{netAssetValuePerShare,jdbcType=VARCHAR},
      </if>
      <if test="earningsPerShare != null" >
        #{earningsPerShare,jdbcType=VARCHAR},
      </if>
      <if test="salesMargin != null" >
        #{salesMargin,jdbcType=VARCHAR},
      </if>
      <if test="grossMargin != null" >
        #{grossMargin,jdbcType=VARCHAR},
      </if>
      <if test="netProfitMarginOnSales != null" >
        #{netProfitMarginOnSales,jdbcType=VARCHAR},
      </if>
      <if test="operatingProfitRatio != null" >
        #{operatingProfitRatio,jdbcType=VARCHAR},
      </if>
      <if test="yearOverYearGrowthInEarningsPerShare != null" >
        #{yearOverYearGrowthInEarningsPerShare,jdbcType=VARCHAR},
      </if>
      <if test="yearOverYearGrowthRateOfOperatingIncome != null" >
        #{yearOverYearGrowthRateOfOperatingIncome,jdbcType=VARCHAR},
      </if>
      <if test="yearOnYearGrowthRateOfNetProfit != null" >
        #{yearOnYearGrowthRateOfNetProfit,jdbcType=VARCHAR},
      </if>
      <if test="yearOverYearReturnOnEquityGrowth != null" >
        #{yearOverYearReturnOnEquityGrowth,jdbcType=VARCHAR},
      </if>
      <if test="rateOfStockTurnover != null" >
        #{rateOfStockTurnover,jdbcType=VARCHAR},
      </if>
      <if test="turnoverOfTotalCapital != null" >
        #{turnoverOfTotalCapital,jdbcType=VARCHAR},
      </if>
      <if test="totalAssets != null" >
        #{totalAssets,jdbcType=VARCHAR},
      </if>
      <if test="netAsset != null" >
        #{netAsset,jdbcType=VARCHAR},
      </if>
      <if test="assetLiabilityRatio != null" >
        #{assetLiabilityRatio,jdbcType=VARCHAR},
      </if>
      <if test="liquidityRatio != null" >
        #{liquidityRatio,jdbcType=VARCHAR},
      </if>
      <if test="quickRatio != null" >
        #{quickRatio,jdbcType=VARCHAR},
      </if>
      <if test="salesGrowthRate != null" >
        #{salesGrowthRate,jdbcType=VARCHAR},
      </if>
      <if test="compositionOfOperatingIncomeLimousine != null" >
        #{compositionOfOperatingIncomeLimousine,jdbcType=VARCHAR},
      </if>
      <if test="compositionOfOperatingIncomeH6 != null" >
        #{compositionOfOperatingIncomeH6,jdbcType=VARCHAR},
      </if>
      <if test="compositionOfOperatingIncomePickup != null" >
        #{compositionOfOperatingIncomePickup,jdbcType=VARCHAR},
      </if>
      <if test="compositionOfOperatingIncomeWey != null" >
        #{compositionOfOperatingIncomeWey,jdbcType=VARCHAR},
      </if>
      <if test="compositionOfOperatingIncomeH8 != null" >
        #{compositionOfOperatingIncomeH8,jdbcType=VARCHAR},
      </if>
      <if test="compositionOfNetProfitLimousine != null" >
        #{compositionOfNetProfitLimousine,jdbcType=VARCHAR},
      </if>
      <if test="compositionOfNetProfitH6 != null" >
        #{compositionOfNetProfitH6,jdbcType=VARCHAR},
      </if>
      <if test="compositionOfNetProfitPickup != null" >
        #{compositionOfNetProfitPickup,jdbcType=VARCHAR},
      </if>
      <if test="compositionOfNetProfitWey != null" >
        #{compositionOfNetProfitWey,jdbcType=VARCHAR},
      </if>
      <if test="compositionOfNetProfitH8 != null" >
        #{compositionOfNetProfitH8,jdbcType=VARCHAR},
      </if>
      <if test="developmentExpenditure != null" >
        #{developmentExpenditure,jdbcType=VARCHAR},
      </if>
      <if test="developmentExpenditurePercentageRevenue != null" >
        #{developmentExpenditurePercentageRevenue,jdbcType=VARCHAR},
      </if>
      <if test="h6MarketShare != null" >
        #{h6MarketShare,jdbcType=VARCHAR},
      </if>
      <if test="h8MarketShare != null" >
        #{h8MarketShare,jdbcType=VARCHAR},
      </if>
      <if test="weyMarketShare != null" >
        #{weyMarketShare,jdbcType=VARCHAR},
      </if>
      <if test="newProductContributionRate != null" >
        #{newProductContributionRate,jdbcType=VARCHAR},
      </if>
      <if test="classId != null" >
        #{classId,jdbcType=INTEGER},
      </if>
      <if test="teamId != null" >
        #{teamId,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>

  <select id="getAnnual" resultType="com.tzcpa.model.student.TeamAnnualWorthGather">

    select
    profit.class_id,
    profit.team_id,
    <!-- #净资产收益率 -->
    profit.retained_profits/((lastdebt.total_owners_equity+debt.total_owners_equity)/2)
    net_assets_income_rate,
    <!--  #净利润 -->
    profit.retained_profits retained_profits,
    <!-- #营业收入 -->
    profit.gross_revenue operation_revenue,
    <!-- #每股净资产 -->
    debt.total_owners_equity/debt.capitalization*100 net_asset_value_per_share,
    <!-- #每股收益-->
    profit.retained_profits/debt.capitalization*100 earnings_per_share,
    <!-- #销售毛利 -->
    profit.gross_revenue-profit.operating_cost sales_margin,
    <!-- #销售毛利率 -->
    (profit.gross_revenue-profit.operating_cost)/profit.gross_revenue gross_margin,
    <!-- #销售净利率 -->
    profit.retained_profits/profit.gross_revenue net_profit_margin_on_sales,
    <!-- #营业利润率 -->
    profit.operating_profit/profit.gross_revenue operating_profit_ratio,
    <!-- #每股收益同比增长率 -->
    (profit.retained_profits/debt.capitalization)/
    (lastprofit.retained_profits / lastdebt.capitalization)
    -1 year_over_year_growth_in_earnings_per_share,
    <!-- #营业收入同比增长率 -->
    (profit.gross_revenue / lastprofit.gross_revenue -1)
    year_over_year_growth_rate_of_operating_income,
    <!-- #净利润同比增长率 -->
    (profit.retained_profits/lastprofit.retained_profits -1)
    year_on_year_growth_rate_of_net_profit,
    <!-- #净资产收益率同比增长率 -->
    ( IFNULL(profit.retained_profits,0)/((IFNULL(lastdebt.total_owners_equity,0)+IFNULL(debt.total_owners_equity,0))/2)
    /IFNULL(analysis.net_assets_income_rate,lastdebt.return_on_equity) -1)
    year_over_year_return_on_equity_growth,
    <!-- # 存货周转率 -->
    profit.operating_cost/((lastdebt.inventory+debt.inventory) /2)
    rate_of_stock_turnover,
    <!-- #总资产周转率 -->
    profit.gross_revenue/((lastdebt.total_assets+debt.total_assets) /2)
    turnover_of_total_capital,
    <!-- #总资产 -->
    debt.total_assets total_assets,
    <!-- #净资产 -->
    debt.total_owners_equity net_asset,
    <!-- #资产负债率 -->
    debt.total_liability / debt.total_assets asset_liability_ratio,
    <!-- #流动比率 -->
    debt.total_current_assets/ debt.total_current_liability liquidity_ratio,
    <!-- #速动比率 -->
    (debt.total_current_assets- debt.inventory - debt.prepayment)/debt.total_current_liability
    quick_ratio,
    <!-- #销量增长率 -->
    (sum(IFNULL(localtti.adjusted_sales,0))-
    IFNULL(sum(lasetti.adjusted_sales),lastdebt.adjusted_sales))
    /IFNULL(sum(lasetti.adjusted_sales),lastdebt.adjusted_sales) sales_growth_rate,
    <!-- #营业收入构成-轿车-->
    sum(
    case localtti.vehicle_model when 'limousine' then localtti.final_sales else 0 end
    )/profit.operation_revenue composition_of_operating_income_limousine,
    <!-- #营业收入构成-H6 -->
    sum(
    case localtti.vehicle_model when 'h6' then localtti.final_sales else 0 end
    )/profit.operation_revenue composition_of_operating_income_h6,
    <!--  #营业收入构成-皮卡 -->
     sum(
     case localtti.vehicle_model when 'pickup' then localtti.final_sales else 0 end
     )/profit.operation_revenue composition_of_operating_income_pickup,
    <!-- #营业收入构成-WEY -->
    sum(
    case localtti.vehicle_model when 'wey' then localtti.final_sales else 0 end
    )/profit.operation_revenue composition_of_operating_income_wey,
    <!-- #营业收入构成-H8 -->
    sum(
    case localtti.vehicle_model when 'h8' then localtti.final_sales else 0 end
    )/profit.operation_revenue composition_of_operating_income_h8,

    # <!-- #净利润构成-轿车-->
    sum(
    case localtti.vehicle_model when 'limousine' then
    localtti.final_sales - localtti.final_operating_cost_plus -
    localtti.final_operating_tax_surcharge
    - localtti.final_sales_total - localtti.final_management_total -
    localtti.final_financial_cost -
    localtti.final_assets_impairment_loss_total +
    localtti.final_nonbusiness_income - localtti.final_nonbusiness_expenditure
    else 0 end
    ) * 0.85 /profit.retained_profits
    composition_of_net_profit_limousine,

    #<!-- #净利润构成-h6 -->
    sum(
    case localtti.vehicle_model when 'h6' then
    localtti.final_sales - localtti.final_operating_cost_plus -
    localtti.final_operating_tax_surcharge
    - localtti.final_sales_total - localtti.final_management_total -
    localtti.final_financial_cost -
    localtti.final_assets_impairment_loss_total +
    localtti.final_nonbusiness_income - localtti.final_nonbusiness_expenditure
    else 0 end
    ) * 0.85/profit.retained_profits
    composition_of_net_profit_h6,
    # <!-- #净利润构成-皮卡 -->
    sum(
    case localtti.vehicle_model when 'pickup' then
    localtti.final_sales - localtti.final_operating_cost_plus -
    localtti.final_operating_tax_surcharge
    - localtti.final_sales_total - localtti.final_management_total -
    localtti.final_financial_cost -
    localtti.final_assets_impairment_loss_total +
    localtti.final_nonbusiness_income - localtti.final_nonbusiness_expenditure
    else 0 end
    ) * 0.85/profit.retained_profits
    composition_of_net_profit_pickup,

    #<!-- #净利润构成-wey-->
    sum(
    case localtti.vehicle_model when 'wey' then
    localtti.final_sales - localtti.final_operating_cost_plus -
    localtti.final_operating_tax_surcharge
    - localtti.final_sales_total - localtti.final_management_total -
    localtti.final_financial_cost -
    localtti.final_assets_impairment_loss_total +
    localtti.final_nonbusiness_income - localtti.final_nonbusiness_expenditure
    else 0 end
    ) * 0.85/profit.retained_profits
    composition_of_net_profit_wey,
    #<!-- #净利润构成-h8 -->
    sum(
    case localtti.vehicle_model when 'h8' then
    localtti.final_sales - localtti.final_operating_cost_plus -
    localtti.final_operating_tax_surcharge
    - localtti.final_sales_total - localtti.final_management_total -
    localtti.final_financial_cost -
    localtti.final_assets_impairment_loss_total +
    localtti.final_nonbusiness_income - localtti.final_nonbusiness_expenditure
    else 0 end
    ) * 0.85/profit.retained_profits
    composition_of_net_profit_h8,
    <!-- #研发费用-->
    profit.development_expenditure,
    <!-- #研发费用投入占当年营收比 -->
    profit.development_expenditure
    /profit.gross_revenue
    development_expenditure_percentage_revenue,
    <!-- #H6市场份额占比 -->
    sum(case localtti.vehicle_model when 'h6' then localtti.adjusted_sales else 0 end)
    /sum(case localtti.vehicle_model when 'h6' then localtti.market_shares else 0 end)
    h6_market_share,
    <!--  #H8市场份额占比 -->
    sum(case localtti.vehicle_model when 'h8' then localtti.adjusted_sales else 0 end)
    /sum(case localtti.vehicle_model when 'h6' then localtti.market_shares else 0 end)
    h8_market_share,
    <!-- #WEY市场份额占比 -->
    sum(case localtti.vehicle_model when 'wey' then localtti.adjusted_sales else 0 end)
    /sum(case localtti.vehicle_model when 'h6' then localtti.market_shares else 0 end)
    wey_market_share,
    <!-- #新产品贡献率 -->
    case when profit.`year` &lt;= 2013
    then sum(case localtti.vehicle_model when 'h6' then localtti.final_sales else 0 end)
    /profit.gross_revenue
    when profit.`year` &lt;= 2016
    THEN
    sum(case localtti.vehicle_model when 'h8' then localtti.final_sales else 0 end)
    /profit.gross_revenue
    when profit.`year` &lt;= 2018
    THEN
    sum(case localtti.vehicle_model when 'wey' then localtti.final_sales else 0 end)
    /profit.gross_revenue
    else 0
    end
    new_product_contribution_rate,
    profit.year

    from
    t_team_profit_statement profit
    left join
    t_team_profit_statement lastprofit
    on profit.class_id = lastprofit.class_id
    and profit.team_id = lastprofit.team_id
    and lastprofit.year =  #{lastYear}
    left join
    t_team_balance_sheet debt
    on profit.class_id = debt.class_id
    and profit.team_id = debt.team_id
    and debt.year = cast( date_format(#{currentDate}, '%Y') AS SIGNED)

    left join
    t_team_balance_sheet lastdebt
    on profit.class_id = lastdebt.class_id
    and profit.team_id = lastdebt.team_id
    and lastdebt.year =  #{lastYear}

    left join t_team_annual_worth_gather analysis
    on profit.class_id = analysis.class_id
    and profit.team_id = analysis.team_id
    and analysis.`year` =  #{lastYear}

    left join t_team_intermediate localtti
    on profit.class_id = localtti.class_id and profit.team_id = localtti.team_id
    and localtti.year = cast( date_format(#{currentDate}, '%Y') AS SIGNED)
    left join t_team_intermediate lasetti
    on localtti.class_id = lasetti.class_id and localtti.team_id = lasetti.team_id
    and localtti.`month` = lasetti.`month` and localtti.vehicle_model = lasetti.vehicle_model
    and lasetti.`year` = #{lastYear}
    where
    profit.class_id = #{classId} and profit.team_id = #{teamId}
    <!-- and profit.team_id =29 -->
    and profit.`year` = cast( date_format(#{currentDate}, '%Y') AS SIGNED)
    GROUP BY profit.class_id , profit.team_id

  </select>

  <select id="getTeamAnnualWorthGather" resultType="com.tzcpa.model.student.TeamAnnualWorthGather">

      select * from t_team_annual_worth_gather
      tawg
      where
      tawg.class_id = #{classId}
      and tawg.team_id = #{teamId}
      and tawg.`year` = #{year}
      limit 1
  </select>
  
  <select id="getYFFZB" resultType="java.lang.Double" >
  	SELECT
		ROUND(development_expenditure / gross_revenue,7)
	FROM
		t_team_profit_statement
	WHERE
		class_id = #{classId}
	AND team_id = #{teamId}
	AND `year` = #{year}
  </select>
</mapper>